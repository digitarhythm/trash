#!/bin/bash

# home directory
HOME=`echo ~`
# trash directory
TRASH="${HOME}/.Trash"
# option string
TARGET="$@"
# first arg
ARGS=(`echo "$@"`)

# option value
CLEAN=0

if [ -z "${ARGS[0]}" ]; then
  echo "Usage: trash [option] [delete file name]"
  echo "option:"
  echo "  --clean    delete all files in .Trash directory."
  exit
fi

for arg in ${TARGET}; do
  if [ "${arg}" = "--clean" ]; then
    CLEAN=1
  fi
done

if [ ! -d ${TRASH} ]; then
  mkdir ${TRASH}
fi

for file in ${TARGET} ; do
  if [[ ! ${file} =~ ^-.*$ ]]; then
    if [ -e ${file} ]; then
      org=${file}
      if [[ ${file} =~ ^(.*)\/$ ]]; then
        file=${BASH_REMATCH[1]}
      fi
      if [[ ${file} =~ ^.*\/(.*) ]]; then
        file=${BASH_REMATCH[1]}
      fi
      fname=${file}
      loop=1
      while [ -e "${TRASH}/${fname}" ]; do
        fname="${file}.${loop}"
        loop=$((loop+1))
      done
      if [ ${CLEAN} -eq 0 ]; then
        echo "'${file}' is move to Trash.: ${fname}"
      else
        echo "'${file}' is move to Trash and clean \".Trash\"."
      fi
      mv -f ${org} "${TRASH}/${fname}"
    else
      echo "file not found: ${file}"
    fi
  fi
done

if [ ${CLEAN} -eq 1 ]; then
  find ${TRASH} -maxdepth 1 -regex "${TRASH}/.+" -exec rm -rf {} \;
else
  find ${TRASH} -maxdepth 1 -regex "${TRASH}/.+" -ctime +30 -exec rm -rf {} \;
fi

#
