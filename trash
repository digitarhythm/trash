#!/bin/bash

HOME=`echo ~`
TRASH="${HOME}/.Trash"
TARGET="$@"
ARG1="$1"

if [ -z ${ARG1} ]; then
  echo "Usage: trash [option] [delete file name]"
  echo "option:"
  echo "  --clean    delete all files in .Trash directory."
  exit
fi

if [ ${ARG1} = "--clean" ]; then
  find ${TRASH} -maxdepth 1 -regex "${TRASH}/.+" -exec rm -rf {} \;
  exit
fi

if [ ! -d ${TRASH} ]; then
  mkdir ${TRASH}
fi

for file in ${TARGET} ; do
  if [ -e ${file} ]; then
    if [[ ${file} =~ ^(.*?)\/$ ]]; then
      file=${BASH_REMATCH[1]}
    fi
    fname=${file}
    loop=1
    while [ -e "${TRASH}/${fname}" ]; do
      fname="${file}.${loop}"
      loop=$((loop+1))
    done
    echo "'${file}' is move to Trash.: ${fname}"
    mv -f ${file} "${TRASH}/${fname}"
  else
    echo "file not found: ${TARGET}"
  fi
done

find ${TRASH} -maxdepth 1 -regex "${TRASH}/.+" -ctime +30 -exec rm -rf {} \;
